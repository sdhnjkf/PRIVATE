
-- PRIVATE PAYLOAD (RUMBLE)
-- Keep this file private and obfuscate it.

-- Try to resolve the config provided by the public script.
-- We attempt multiple strategies to support various executors:
local CFG_Dungeon, CFG_Stuff

-- 1) If the public script promoted them to globals (or the executor exposes locals), read them:
CFG_Dungeon = rawget(_G, "Dungeon") or Dungeon
CFG_Stuff   = rawget(_G, "Stuff")   or Stuff

-- 2) If the public script (or your environment) uses getgenv/shared:
if (not CFG_Dungeon or not CFG_Stuff) and getgenv then
    local g = getgenv()
    CFG_Dungeon = CFG_Dungeon or g.Dungeon or (g.AF_CONFIG and g.AF_CONFIG.Dungeon)
    CFG_Stuff   = CFG_Stuff   or g.Stuff   or (g.AF_CONFIG and g.AF_CONFIG.Stuff)
end

-- 3) Final fallback defaults if nothing was visible (keeps the script running)
if not CFG_Dungeon then
    CFG_Dungeon = { Difficulty = "Hard", PartyOnly = true, Hardcore = false, Location = "Jungle Temple" }
end
if not CFG_Stuff then
    CFG_Stuff = { AutoSell = false, JoinHighestDungeon = true, RestartTime = 250 }
end

-- Ensure LocalPlayer exists
repeat task.wait() until game.Players and game.Players.LocalPlayer
local Player = game.Players.LocalPlayer

-- ========= PRIVATE WHITELIST (hidden here) =========
local Allowed = {
    [3103840569] = true, -- replace with your IDs
    [5036814396] = true,
}
if not Allowed[Player.UserId] then
    Player:Kick("Access denied: you are not authorized to run this script.")
    return
end
-- ================================================

-- Your original logic (unchanged)

-- SERVICES
local TweenService      = game:GetService("TweenService")
local RunService        = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Teleportlocal TeleportService   = game:GetService("TeleportService")

wait(10)
print("Auto Farm Script Loaded")

-- Anti-Fall Protection
RunService.Stepped:Connect(function()
    pcall(function()
        local humanoid = Player.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid:ChangeState(Enum.HumanoidStateType.Physics)
        end
    end)
end)

-- Tween Movement Function
local function toTarget(startPos, targetPos, targetCFrame)
    local tweenInfo = TweenInfo.new((targetPos - startPos).Magnitude / 80, Enum.EasingStyle.Quad)
    local ok, err = pcall(function()
        local tween = TweenService:Create(Player.Character.HumanoidRootPart, tweenInfo, {CFrame = targetCFrame})
        tween:Play()
    end)
    if not ok then warn(err) end
end

-- AutoSell Function
local function autoSell()
    if CFG_Stuff.AutoSell and game.workspace:FindFirstChild("Lobby") then
        Player.Character.HumanoidRootPart.CFrame = CFrame.new(-418.266968, 25.2, 408.361694)
        for _, item in pairs(Player.PlayerGui.ScreenGui.Sell.Sell.Inner.Items.Frame.Items:GetChildren()) do
            if item.Name ~= "UIGridLayout" and not item.Equipped.Visible and not item.RarityBackground.Visible then
                ReplicatedStorage.Modules.Network.RemoteFunction:InvokeServer("SellItems", {{"Weapon", item.Name}})
                ReplicatedStorage.Modules.Network.RemoteFunction:InvokeServer("SellItems", {{"Armor", item.Name}})
                ReplicatedStorage.Modules.Network.RemoteFunction:InvokeServer("SellItems", {{"Ability", item.Name}})
            end
        end
    end
end

-- Dungeon Creation (same as your original)
spawn(function()
    while wait() do
        pcall(function()
            if game.workspace:FindFirstChild("Lobby") then
                autoSell()
                local create = "CreateLobby"
                local start  = "StartDungeon"
                ReplicatedStorage.Modules.Network.RemoteFunction:InvokeServer(create, CFG_Dungeon)
                ReplicatedStorage.Modules.Network.RemoteEvent:FireServer(start)
            end
        end)
    end
end)

-- Restart Timer
local Time = 0
spawn(function()
    while wait(1) do
        if not game.workspace:FindFirstChild("Lobby") then
            Time = Time + 1
            if Time >= CFG_Stuff.RestartTime then
                TeleportService:Teleport(4390380541, Player)
            end
        end
    end
end)

-- Enemy Farming
local attackCount = 0
while wait() do
    pcall(function()
        if Player.Character and not game.workspace:FindFirstChild("Lobby") then
            for _, weaponModel in pairs(Player.Character:GetChildren()) do
                if weaponModel:IsA("Model") then
                    for _, enemy in pairs(game.workspace.Enemies:GetChildren()) do
                        if enemy:FindFirstChild("Humanoid") and enemy:FindFirstChild("HumanoidRootPart") then
                            repeat
                                attackCount = attackCount + 1
                                -- Float ABOVE enemy (change 5 to adjust height)
                                toTarget(
                                    Player.Character.HumanoidRootPart.Position,
                                    enemy.HumanoidRootPart.Position,
                                    enemy.HumanoidRootPart.CFrame * CFrame.new(0, 5, 0)
                                )

                                -- Attack enemy
                                local remoteEvent = ReplicatedStorage.Modules.Network.RemoteEvent
                                for i = 1, 10 do
                                    remoteEvent:FireServer("WeaponDamage", weaponModel.Name, enemy.Humanoid)
                                end

                                wait()
                                if attackCount >= 100 then
                                    enemy.Humanoid.Health = 0
                                end
                            until enemy.Humanoid.Health <= 0
                            attackCount = 0
                        end
                    end
                end
            end
        end
    end)

